<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MFG Agent â€” Supplier Finder</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* â”€â”€ RESET & BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg0:      #0e0f11;
  --bg1:      #141518;
  --bg2:      #1b1d21;
  --bg3:      #22252b;
  --border:   #2a2d35;
  --border2:  #353840;
  --text:     #e2e5ec;
  --muted:    #7a7f8e;
  --faint:    #3a3e48;

  --accent:   #f97316;        /* orange â€” industrial */
  --accent2:  #fb923c;
  --accentBg: rgba(249,115,22,0.10);
  --accentBorder: rgba(249,115,22,0.30);

  --green:    #22c55e;
  --greenBg:  rgba(34,197,94,0.10);
  --yellow:   #eab308;
  --red:      #ef4444;
  --blue:     #60a5fa;

  --chat-w:  740px;
  --sidebar: 260px;
  --mono: 'DM Mono', monospace;
  --sans: 'Syne', sans-serif;
}

html, body { height: 100%; background: var(--bg0); color: var(--text); font-family: var(--sans); }

/* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shell {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  width: var(--sidebar);
  background: var(--bg1);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}

.sidebar-logo {
  padding: 20px 18px 16px;
  border-bottom: 1px solid var(--border);
}

.logo-mark {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-icon {
  width: 32px; height: 32px;
  background: var(--accent);
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.logo-text {
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 0.3px;
  line-height: 1.2;
}

.logo-sub {
  font-size: 10px;
  font-family: var(--mono);
  color: var(--muted);
  letter-spacing: 1px;
  margin-top: 2px;
}

.sidebar-section {
  padding: 14px 18px 8px;
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 3px;
  color: var(--faint);
  text-transform: uppercase;
}

.example-btn {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  width: 100%;
  background: none;
  border: none;
  padding: 10px 18px;
  cursor: pointer;
  text-align: left;
  border-radius: 0;
  transition: background 0.15s;
  color: var(--muted);
  font-family: var(--sans);
  font-size: 12.5px;
  line-height: 1.45;
}

.example-btn:hover {
  background: var(--bg2);
  color: var(--text);
}

.example-icon {
  font-size: 14px;
  margin-top: 1px;
  flex-shrink: 0;
}

.sidebar-spacer { flex: 1; }

.sidebar-status {
  padding: 14px 18px;
  border-top: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 11px;
}

.status-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: var(--muted);
}

.status-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--green);
  animation: pulse-dot 2.5s ease-in-out infinite;
  flex-shrink: 0;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.35; }
}

.status-model {
  margin-top: 6px;
  color: var(--faint);
  font-size: 10px;
  letter-spacing: 0.5px;
}

/* â”€â”€ SOURCES PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sources-panel {
  padding: 12px 18px;
  border-top: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 10px;
}

.sources-title {
  letter-spacing: 3px;
  color: var(--faint);
  text-transform: uppercase;
  margin-bottom: 8px;
}

.source-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.source-tag {
  padding: 2px 7px;
  border-radius: 4px;
  font-size: 9px;
  letter-spacing: 0.5px;
  border: 1px solid var(--border);
  color: var(--faint);
  background: var(--bg2);
  transition: all 0.2s;
}

.source-tag.on {
  border-color: rgba(34,197,94,0.3);
  color: var(--green);
  background: rgba(34,197,94,0.07);
}

.source-tag.search {
  border-color: var(--accentBorder);
  color: var(--accent);
  background: var(--accentBg);
}

/* â”€â”€ MAIN PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--bg0);
}

/* top bar */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  height: 52px;
  border-bottom: 1px solid var(--border);
  background: var(--bg1);
  flex-shrink: 0;
}

.topbar-title {
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.2px;
  color: var(--text);
}

.topbar-meta {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  display: flex;
  gap: 16px;
}

.pill {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 3px 10px;
  border-radius: 999px;
  font-family: var(--mono);
  font-size: 10px;
  border: 1px solid var(--border2);
  color: var(--muted);
  background: var(--bg2);
}

.pill.live {
  border-color: var(--accentBorder);
  color: var(--accent);
  background: var(--accentBg);
}

/* â”€â”€ STOP BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#stopBtn {
  display: none;
  align-items: center;
  gap: 6px;
  padding: 5px 14px;
  border-radius: 6px;
  border: 1px solid rgba(239,68,68,0.45);
  background: rgba(239,68,68,0.10);
  color: #ef4444;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  cursor: pointer;
  letter-spacing: 0.5px;
  transition: all 0.15s;
}
#stopBtn:hover {
  background: rgba(239,68,68,0.20);
  border-color: rgba(239,68,68,0.7);
}
#stopBtn.visible { display: inline-flex; }

/* â”€â”€ CHAT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chat-area {
  flex: 1;
  overflow-y: auto;
  padding: 32px 24px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.chat-area::-webkit-scrollbar { width: 4px; }
.chat-area::-webkit-scrollbar-track { background: transparent; }
.chat-area::-webkit-scrollbar-thumb { background: var(--faint); border-radius: 4px; }

/* welcome */
.welcome {
  max-width: var(--chat-w);
  margin: 60px auto 0;
  text-align: center;
  animation: fadein 0.5s ease;
}

.welcome-icon {
  font-size: 42px;
  margin-bottom: 16px;
}

.welcome h2 {
  font-size: 26px;
  font-weight: 800;
  margin-bottom: 10px;
  background: linear-gradient(135deg, var(--text) 0%, var(--accent) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.welcome p {
  font-size: 14px;
  color: var(--muted);
  line-height: 1.7;
  max-width: 480px;
  margin: 0 auto;
}

/* message rows */
.msg-row {
  display: flex;
  gap: 14px;
  max-width: var(--chat-w);
  width: 100%;
  margin: 0 auto;
  animation: fadein 0.3s ease;
}

.msg-row.user { justify-content: flex-end; }

@keyframes fadein {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

.avatar {
  width: 32px; height: 32px;
  border-radius: 8px;
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px;
  margin-top: 2px;
}

.avatar.agent { background: var(--accentBg); border: 1px solid var(--accentBorder); }
.avatar.user  { background: var(--bg3);      border: 1px solid var(--border2); }

.bubble {
  border-radius: 12px;
  padding: 12px 16px;
  font-size: 14px;
  line-height: 1.65;
  max-width: 100%;
}

.bubble.user {
  background: var(--bg2);
  border: 1px solid var(--border2);
  color: var(--text);
  border-bottom-right-radius: 3px;
}

.bubble.agent {
  background: var(--bg1);
  border: 1px solid var(--border);
  color: var(--text);
  border-bottom-left-radius: 3px;
  flex: 1;
}

/* â”€â”€ LOG STREAM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.log-stream {
  font-family: var(--mono);
  font-size: 11.5px;
  line-height: 1.8;
  padding: 10px 14px;
  background: var(--bg0);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-top: 10px;
  max-height: 200px;
  overflow-y: auto;
  color: var(--muted);
}

.log-stream::-webkit-scrollbar { width: 3px; }
.log-stream::-webkit-scrollbar-thumb { background: var(--faint); }

.log-line { display: flex; gap: 8px; align-items: flex-start; }
.log-ts   { color: var(--faint); flex-shrink: 0; }

.log-line.agent   .log-msg { color: var(--accent); font-weight: 500; }
.log-line.success .log-msg { color: var(--green); }
.log-line.warn    .log-msg { color: var(--yellow); }
.log-line.error   .log-msg { color: var(--red); }
.log-line.system  .log-msg { color: var(--blue); }
.log-line.info    .log-msg { color: var(--muted); }

/* â”€â”€ SUPPLIER CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.supplier-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 10px;
  margin-top: 12px;
}

.sup-card {
  background: var(--bg0);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
  font-size: 12px;
  line-height: 1.6;
  transition: border-color 0.2s;
}

.sup-card:hover { border-color: var(--accentBorder); }

.sup-name {
  font-family: var(--sans);
  font-weight: 700;
  font-size: 13px;
  color: var(--text);
  margin-bottom: 6px;
}

.sup-row {
  display: flex;
  gap: 6px;
  color: var(--muted);
}

.sup-key {
  color: var(--faint);
  font-family: var(--mono);
  font-size: 10px;
  flex-shrink: 0;
  padding-top: 1px;
}

.sup-val { word-break: break-word; }

.sup-badge {
  display: inline-block;
  padding: 1px 7px;
  border-radius: 4px;
  font-family: var(--mono);
  font-size: 9px;
  background: var(--accentBg);
  color: var(--accent);
  border: 1px solid var(--accentBorder);
  margin-top: 4px;
}

/* â”€â”€ REPORT BLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.report-block {
  margin-top: 14px;
  background: var(--bg0);
  border: 1px solid var(--border2);
  border-radius: 8px;
  overflow: hidden;
}

.report-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
}

.report-title {
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 1px;
  color: var(--accent);
}

.copy-btn {
  background: none;
  border: 1px solid var(--border2);
  color: var(--muted);
  padding: 3px 10px;
  border-radius: 5px;
  font-family: var(--mono);
  font-size: 10px;
  cursor: pointer;
  transition: all 0.15s;
}

.copy-btn:hover {
  border-color: var(--accentBorder);
  color: var(--accent);
}

.dl-btn {
  background: none;
  border: 1px solid var(--border2);
  color: var(--muted);
  padding: 3px 10px;
  border-radius: 5px;
  font-family: var(--mono);
  font-size: 10px;
  cursor: pointer;
  transition: all 0.15s;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  text-decoration: none;
}
.dl-btn:hover {
  border-color: rgba(96,165,250,0.5);
  color: var(--blue);
}
.dl-btn.pdf:hover {
  border-color: rgba(249,115,22,0.5);
  color: var(--accent);
}
.report-actions {
  display: flex;
  align-items: center;
  gap: 6px;
}

/* â”€â”€ PRINT / PDF STYLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media print {
  body { background: #fff !important; color: #111 !important; font-family: 'Courier New', monospace; }
  .shell, .main { display: block !important; height: auto !important; overflow: visible !important; }
  .sidebar, .topbar, .input-area, .steps, .typing-dots, .log-stream,
  .supplier-grid, .meta-row, .report-actions, #welcomeMsg,
  .msg-row:not(.print-target), .avatar { display: none !important; }
  .msg-row.print-target { display: block !important; }
  .chat-area { overflow: visible !important; padding: 0 !important; }
  .bubble.agent { background: #fff !important; border: none !important;
                  box-shadow: none !important; padding: 0 !important; }
  .report-block { border: 1px solid #ccc !important; border-radius: 0 !important;
                  background: #fff !important; page-break-inside: avoid; }
  .report-header { background: #f4f4f4 !important; border-bottom: 1px solid #ccc !important; }
  .report-title { color: #c2410c !important; }
  .report-body { max-height: none !important; overflow: visible !important;
                 font-size: 11px !important; line-height: 1.6 !important;
                 color: #111 !important; }
  @page { margin: 18mm 15mm; size: A4; }
}

.report-body {
  padding: 16px 18px;
  font-family: var(--mono);
  font-size: 12px;
  line-height: 1.85;
  white-space: pre-wrap;
  word-break: break-word;
  color: var(--text);
  max-height: 520px;
  overflow-y: auto;
}

.report-body::-webkit-scrollbar { width: 3px; }
.report-body::-webkit-scrollbar-thumb { background: var(--faint); }

/* meta pills row */
.meta-row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 10px;
}

/* â”€â”€ INPUT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.input-area {
  padding: 16px 24px 20px;
  border-top: 1px solid var(--border);
  background: var(--bg1);
  flex-shrink: 0;
}

.input-wrap {
  max-width: var(--chat-w);
  margin: 0 auto;
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

.input-box {
  flex: 1;
  background: var(--bg2);
  border: 1px solid var(--border2);
  border-radius: 12px;
  padding: 12px 16px;
  color: var(--text);
  font-family: var(--sans);
  font-size: 14px;
  line-height: 1.5;
  resize: none;
  min-height: 48px;
  max-height: 160px;
  overflow-y: auto;
  outline: none;
  transition: border-color 0.2s;
}

.input-box::placeholder { color: var(--muted); }
.input-box:focus { border-color: var(--accent); }

.send-btn {
  width: 48px; height: 48px;
  border-radius: 12px;
  background: var(--accent);
  border: none;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: background 0.15s, transform 0.1s;
  color: #fff;
  font-size: 18px;
}

.send-btn:hover  { background: var(--accent2); }
.send-btn:active { transform: scale(0.95); }
.send-btn:disabled { background: var(--bg3); cursor: not-allowed; }

.input-hint {
  max-width: var(--chat-w);
  margin: 6px auto 0;
  font-family: var(--mono);
  font-size: 10px;
  color: var(--faint);
  text-align: center;
}

/* â”€â”€ TYPING INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.typing-dots {
  display: flex;
  gap: 4px;
  align-items: center;
  padding: 6px 2px;
}

.typing-dots span {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--accent);
  animation: bounce 1.2s ease-in-out infinite;
}

.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes bounce {
  0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
  40%            { transform: translateY(-5px); opacity: 1; }
}

/* â”€â”€ STEP INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.steps {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.step {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  border-radius: 6px;
  font-family: var(--mono);
  font-size: 10px;
  border: 1px solid var(--border);
  color: var(--faint);
  background: var(--bg2);
  transition: all 0.3s;
}

.step.active  { border-color: var(--accentBorder); color: var(--accent); background: var(--accentBg); }
.step.done    { border-color: rgba(34,197,94,0.3);  color: var(--green);  background: var(--greenBg); }

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 680px) {
  .sidebar { display: none; }
  .chat-area { padding: 20px 14px; }
  .input-area { padding: 12px 14px 16px; }
  .topbar-meta { display: none; }
}
</style>
</head>
<body>

<div class="shell">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-mark">
        <div class="logo-icon">âš™</div>
        <div>
          <div class="logo-text">MFG Agent</div>
          <div class="logo-sub">SUPPLIER FINDER</div>
        </div>
      </div>
    </div>

    <div class="sidebar-section">Suggested Queries</div>

    <button class="example-btn" onclick="fillInput('Find aluminum suppliers in India')">
      <span class="example-icon">ğŸ­</span>
      Find aluminum suppliers in India
    </button>
    <button class="example-btn" onclick="fillInput('Find PCB manufacturers in China')">
      <span class="example-icon">ğŸ”Œ</span>
      Find PCB manufacturers in China
    </button>
    <button class="example-btn" onclick="fillInput('Find steel pipe suppliers in Germany')">
      <span class="example-icon">ğŸ”©</span>
      Find steel pipe suppliers in Germany
    </button>
    <button class="example-btn" onclick="fillInput('Find plastic injection molding companies in Taiwan')">
      <span class="example-icon">ğŸ§©</span>
      Plastic injection molding in Taiwan
    </button>
    <button class="example-btn" onclick="fillInput('Find rubber gasket suppliers in Maharashtra')">
      <span class="example-icon">â­•</span>
      Rubber gasket suppliers Maharashtra
    </button>
    <button class="example-btn" onclick="fillInput('Find textile fabric wholesalers in Bangladesh')">
      <span class="example-icon">ğŸ§µ</span>
      Textile fabric wholesalers Bangladesh
    </button>

    <div class="sidebar-spacer"></div>

    <!-- Active Sources Panel -->
    <div class="sources-panel">
      <div class="sources-title">Active Sources</div>
      <div class="source-tags" id="sourceTags">
        <span class="source-tag" id="tag-ddg">DDG</span>
        <span class="source-tag" id="tag-tavily">Tavily</span>
        <span class="source-tag" id="tag-serper">Serper</span>
        <span class="source-tag on" id="tag-indiamart">IndiaMART</span>
        <span class="source-tag on" id="tag-alibaba">Alibaba</span>
        <span class="source-tag on" id="tag-tradeindia">TradeIndia</span>
        <span class="source-tag on" id="tag-thomasnet">ThomasNet</span>
        <span class="source-tag on" id="tag-europages">Europages</span>
        <span class="source-tag on" id="tag-kompass">Kompass</span>
        <span class="source-tag on" id="tag-madeinchina">MadeInChina</span>
        <span class="source-tag on" id="tag-globalsources">GlobalSources</span>
        <span class="source-tag on" id="tag-exportersindia">ExportersIndia</span>
      </div>
    </div>

    <div class="sidebar-status">
      <div class="status-row">
        <span>Server</span>
        <div style="display:flex;align-items:center;gap:6px">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">checkingâ€¦</span>
        </div>
      </div>
      <div class="status-model" id="modelLabel">model: â€”</div>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div class="topbar-title">Supplier Intelligence Chat</div>
      <div class="topbar-meta">
        <span id="sessionLabel" class="pill">no session</span>
        <span id="livePill" class="pill" style="display:none">â— LIVE</span>
        <button id="stopBtn" onclick="stopPipeline()">â¹ Stop</button>
      </div>
    </div>

    <div class="chat-area" id="chatArea">
      <div class="welcome" id="welcomeMsg">
        <div class="welcome-icon">âš™ï¸</div>
        <h2>Manufacturing Supplier Finder</h2>
        <p>Ask me to find suppliers, manufacturers, or wholesalers anywhere in the world. I'll search the web and compile a structured procurement report.</p>
      </div>
    </div>

    <div class="input-area">
      <div class="input-wrap">
        <textarea
          id="queryInput"
          class="input-box"
          placeholder="Find aluminum suppliers in Indiaâ€¦"
          rows="1"
          onkeydown="handleKey(event)"
          oninput="autoResize(this)"
        ></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendQuery()" title="Send (Enter)">
          â¤
        </button>
      </div>
      <div class="input-hint">Enter to send Â· Shift+Enter for new line</div>
    </div>
  </div>

</div>

<script>
/* â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const API_BASE = window.location.origin;   // same origin as Flask server

/* â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let busy = false;
let currentSessionId = null;

/* â”€â”€ SERVER HEALTH CHECK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function checkHealth() {
  try {
    const r = await fetch(`${API_BASE}/api/health`);
    const d = await r.json();
    document.getElementById('statusDot').style.background = '#22c55e';
    document.getElementById('statusText').textContent = 'online';
    document.getElementById('modelLabel').textContent  = `model: ${d.model}`;

    // Update search API tags
    const tagDDG    = document.getElementById('tag-ddg');
    const tagTavily = document.getElementById('tag-tavily');
    const tagSerper = document.getElementById('tag-serper');
    if (tagDDG)    { tagDDG.className    = 'source-tag on'; }
    if (tagTavily) { tagTavily.className = d.tavily ? 'source-tag search' : 'source-tag'; }
    if (tagSerper) { tagSerper.className = d.serper ? 'source-tag search' : 'source-tag'; }

    // Update directory tags from server response
    const dirs = d.directories || [];
    const dirMap = {
      indiamart: 'tag-indiamart', tradeindia: 'tag-tradeindia',
      exportersindia: 'tag-exportersindia', alibaba: 'tag-alibaba',
      madeinchina: 'tag-madeinchina', globalsources: 'tag-globalsources',
      thomasnet: 'tag-thomasnet', europages: 'tag-europages',
      kompass: 'tag-kompass',
    };
    for (const [key, tagId] of Object.entries(dirMap)) {
      const el = document.getElementById(tagId);
      if (el) el.className = dirs.includes(key) ? 'source-tag on' : 'source-tag';
    }
  } catch {
    document.getElementById('statusDot').style.background = '#ef4444';
    document.getElementById('statusText').textContent = 'offline';
    document.getElementById('modelLabel').textContent  = 'start: python agents.py --server';
  }
}
checkHealth();
setInterval(checkHealth, 30000);

/* â”€â”€ INPUT HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 160) + 'px';
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendQuery();
  }
}

function fillInput(text) {
  const inp = document.getElementById('queryInput');
  inp.value = text;
  autoResize(inp);
  inp.focus();
}

/* â”€â”€ CHAT HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function hideWelcome() {
  const w = document.getElementById('welcomeMsg');
  if (w) w.remove();
}

function scrollBottom() {
  const area = document.getElementById('chatArea');
  area.scrollTop = area.scrollHeight;
}

function addUserBubble(text) {
  const area = document.getElementById('chatArea');
  area.insertAdjacentHTML('beforeend', `
    <div class="msg-row user">
      <div class="bubble user">${escHtml(text)}</div>
      <div class="avatar user">ğŸ‘¤</div>
    </div>
  `);
  scrollBottom();
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function addAgentBubble() {
  const area = document.getElementById('chatArea');
  const id   = `bubble-${Date.now()}`;
  area.insertAdjacentHTML('beforeend', `
    <div class="msg-row" id="row-${id}">
      <div class="avatar agent">âš™</div>
      <div class="bubble agent" id="${id}">
        <div class="steps" id="steps-${id}">
          <div class="step" id="step-parse-${id}">ğŸ“ Parse</div>
          <div class="step" id="step-search-${id}">ğŸ” Search</div>
          <div class="step" id="step-scrape-${id}">ğŸ•¸ Scrape</div>
          <div class="step" id="step-extract-${id}">ğŸ§  Extract</div>
          <div class="step" id="step-write-${id}">âœ Write</div>
        </div>
        <div class="typing-dots"><span></span><span></span><span></span></div>
        <div class="log-stream" id="log-${id}"></div>
      </div>
    </div>
  `);
  scrollBottom();
  return id;
}

function setStep(id, stepName, state) {
  const el = document.getElementById(`step-${stepName}-${id}`);
  if (!el) return;
  el.classList.remove('active', 'done');
  if (state === 'active') el.classList.add('active');
  if (state === 'done')   el.classList.add('done');
}

function appendLog(id, msg, level) {
  const el = document.getElementById(`log-${id}`);
  if (!el) return;
  const ts  = new Date().toLocaleTimeString('en-US', {hour12: false, hour:'2-digit', minute:'2-digit', second:'2-digit'});
  const div = document.createElement('div');
  div.className = `log-line ${level || 'info'}`;
  div.innerHTML = `<span class="log-ts">${ts}</span><span class="log-msg">${escHtml(msg)}</span>`;
  el.appendChild(div);
  el.scrollTop = el.scrollHeight;
  scrollBottom();
}

function renderSuppliers(id, suppliers) {
  const bubble = document.getElementById(id);
  if (!bubble || !suppliers.length) return;

  let cards = suppliers.map(s => `
    <div class="sup-card">
      <div class="sup-name">${escHtml(s.name || 'â€”')}</div>
      ${s.location ? `<div class="sup-row"><span class="sup-key">ğŸ“</span><span class="sup-val">${escHtml(s.location)}</span></div>` : ''}
      ${s.products ? `<div class="sup-row"><span class="sup-key">ğŸ“¦</span><span class="sup-val">${escHtml(s.products)}</span></div>` : ''}
      ${s.contact  ? `<div class="sup-row"><span class="sup-key">ğŸ“</span><span class="sup-val">${escHtml(s.contact)}</span></div>`  : ''}
      ${s.website  ? `<div class="sup-row"><span class="sup-key">ğŸŒ</span><span class="sup-val"><a href="${escHtml(s.website)}" target="_blank" style="color:var(--accent);text-decoration:none">${escHtml(s.website.replace(/^https?:\/\//,''))}</a></span></div>` : ''}
      ${s.moq      ? `<div class="sup-row"><span class="sup-key">ğŸ“</span><span class="sup-val">MOQ: ${escHtml(s.moq)}</span></div>` : ''}
      ${s.source   ? `<div><span class="sup-badge">${escHtml(s.source)}</span></div>` : ''}
    </div>
  `).join('');

  bubble.insertAdjacentHTML('beforeend', `
    <div style="margin-top:10px;font-family:var(--mono);font-size:10px;letter-spacing:2px;color:var(--muted)">
      SUPPLIERS FOUND (${suppliers.length})
    </div>
    <div class="supplier-grid">${cards}</div>
  `);
  scrollBottom();
}

function renderReport(id, report, meta) {
  const bubble = document.getElementById(id);
  if (!bubble) return;

  // hide typing dots
  const dots = bubble.querySelector('.typing-dots');
  if (dots) dots.remove();

  const repId    = `rep-${id}`;
  const sources  = (meta.sources_used || []).join(', ') || 'Web';
  const srcCount = (meta.sources_used || []).length;

  // Mark the parent row as print target
  const row = bubble.closest('.msg-row');
  if (row) row.classList.add('print-target');

  bubble.insertAdjacentHTML('beforeend', `
    <div class="report-block" style="margin-top:14px">
      <div class="report-header">
        <span class="report-title">PROCUREMENT REPORT</span>
        <div class="report-actions">
          <button class="copy-btn" onclick="copyReport('${repId}')">Copy</button>
          <a class="dl-btn" href="${API_BASE}/api/download/${escHtml(meta.session_id)}" download title="Download as TXT">â¬‡ TXT</a>
          <a class="dl-btn" href="${API_BASE}/api/download-json/${escHtml(meta.session_id)}" download title="Download structured JSON">â¬‡ JSON</a>
          <button class="dl-btn pdf" onclick="printReport('${repId}')" title="Save as PDF via browser print">ğŸ–¨ PDF</button>
        </div>
      </div>
      <pre class="report-body" id="${repId}">${escHtml(report)}</pre>
    </div>
    <div class="meta-row">
      <span class="pill">${escHtml(meta.session_id || '')}</span>
      <span class="pill">â± ${meta.elapsed_seconds}s</span>
      <span class="pill">ğŸ­ ${meta.suppliers_found} suppliers</span>
      <span class="pill">ğŸ“¡ ${srcCount} sources</span>
    </div>
    <div style="margin-top:6px;font-family:var(--mono);font-size:10px;color:var(--faint);max-width:var(--chat-w)">
      Sources: ${escHtml(sources)}
    </div>
  `);
  scrollBottom();
}

function copyReport(repId) {
  const el = document.getElementById(repId);
  if (!el) return;
  navigator.clipboard.writeText(el.textContent).then(() => {
    const btn = el.closest('.report-block').querySelector('.copy-btn');
    if (btn) { btn.textContent = 'Copied!'; setTimeout(() => btn.textContent = 'Copy', 1500); }
  });
}

function printReport(repId) {
  // Hide all other message rows, print only this report, then restore
  const el     = document.getElementById(repId);
  if (!el) return;
  const myRow  = el.closest('.msg-row');
  const allRows = document.querySelectorAll('.msg-row');
  allRows.forEach(r => { if (r !== myRow) r.style.display = 'none'; });
  window.print();
  // Restore after print dialog closes (print is synchronous in most browsers)
  allRows.forEach(r => { r.style.display = ''; });
}

/* â”€â”€ STOP FUNCTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function stopPipeline() {
  if (!currentSessionId) return;
  document.getElementById('stopBtn').classList.remove('visible');
  try {
    await fetch(`${API_BASE}/api/stop`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({session_id: currentSessionId}),
    });
  } catch (e) {
    console.warn('Stop request failed', e);
  }
}

/* â”€â”€ MAIN SEND FUNCTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function sendQuery() {
  if (busy) return;
  const inp   = document.getElementById('queryInput');
  const query = inp.value.trim();
  if (!query) return;

  busy = true;
  inp.value = '';
  inp.style.height = '';
  document.getElementById('sendBtn').disabled = true;

  hideWelcome();
  addUserBubble(query);

  const id = addAgentBubble();

  // update session pill
  document.getElementById('livePill').style.display = '';
  document.getElementById('stopBtn').classList.add('visible');

  // map log keywords to pipeline steps
  const stepMap = {
    'parsing': 'parse', 'parsed': 'parse', 'parse': 'parse',
    'ddg': 'search', 'tavily': 'search', 'serper': 'search', 'searching': 'search', 'search': 'search',
    'scraping': 'scrape', 'scraper': 'scrape', 'indiamart': 'scrape', 'alibaba': 'scrape',
    'tradeindia': 'scrape', 'thomasnet': 'scrape', 'europages': 'scrape', 'kompass': 'scrape',
    'madeinchina': 'scrape', 'globalsources': 'scrape', 'exportersindia': 'scrape', 'page]': 'scrape',
    'extracting': 'extract', 'extract': 'extract', 'structured suppliers': 'extract',
    'writer': 'write', 'report': 'write', 'hand-off received': 'write',
  };

  function detectStep(msg) {
    const lower = msg.toLowerCase();
    for (const [kw, step] of Object.entries(stepMap)) {
      if (lower.includes(kw)) return step;
    }
    return null;
  }

  let currentStep = null;

  try {
    const resp = await fetch(`${API_BASE}/api/query`, {
      method:  'POST',
      headers: {'Content-Type': 'application/json'},
      body:    JSON.stringify({query}),
    });

    const reader = resp.body.getReader();
    const dec    = new TextDecoder();
    let   buf    = '';

    while (true) {
      const {done, value} = await reader.read();
      if (done) break;
      buf += dec.decode(value, {stream: true});

      // SSE frames
      const parts = buf.split('\n\n');
      buf = parts.pop();

      for (const part of parts) {
        if (!part.startsWith('data: ')) continue;
        const raw = part.slice(6).trim();
        if (!raw) continue;

        let evt;
        try { evt = JSON.parse(raw); } catch { continue; }

        if (evt.type === 'log') {
          appendLog(id, evt.message, evt.level);

          // advance step indicator
          const step = detectStep(evt.message);
          if (step && step !== currentStep) {
            if (currentStep) setStep(id, currentStep, 'done');
            setStep(id, step, 'active');
            currentStep = step;
          }

        } else if (evt.type === 'suppliers') {
          if (currentStep) setStep(id, currentStep, 'done');
          setStep(id, 'extract', 'done');
          setStep(id, 'write',   'active');
          currentStep = 'write';
          renderSuppliers(id, evt.data);

        } else if (evt.type === 'done') {
          // mark all done
          ['parse','search','scrape','extract','write'].forEach(s => setStep(id, s, 'done'));
          document.getElementById(`steps-${id}`).style.marginBottom = '8px';

          const session = evt.meta?.session_id || '';
          document.getElementById('sessionLabel').textContent = session;
          document.getElementById('sessionLabel').className   = 'pill live';

          renderReport(id, evt.report, evt.meta);

        } else if (evt.type === 'session') {
          currentSessionId = evt.session_id;

        } else if (evt.type === 'stopped') {
          ['parse','search','scrape','extract','write'].forEach(s => setStep(id, s, 'done'));
          appendLog(id, 'â¹ Pipeline stopped by user.', 'warn');
          const dots = document.getElementById(id)?.querySelector('.typing-dots');
          if (dots) dots.remove();
        }
      }
    }
  } catch (err) {
    appendLog(id, `Connection error: ${err.message}`, 'error');
    const bubble = document.getElementById(id);
    if (bubble) {
      const dots = bubble.querySelector('.typing-dots');
      if (dots) dots.remove();
    }
  }

  document.getElementById('livePill').style.display = 'none';
  document.getElementById('stopBtn').classList.remove('visible');
  currentSessionId = null;
  document.getElementById('sendBtn').disabled = false;
  busy = false;
}
</script>
</body>
</html>